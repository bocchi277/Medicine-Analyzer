<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedSphere</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="icon" href="logo.png" type="image/png">

    <link
        href="https://fonts.googleapis.com/css2?family=Edu+AU+VIC+WA+NT+Arrows:wght@400..700&family=Josefin+Sans:ital,wght@0,100..700;1,100..700&family=Oxanium:wght@200..800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Protest+Revolution&family=Rubik:ital,wght@0,300..900;1,300..900&family=Sixtyfour+Convergence&family=Tiny5&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="style2.css">
    <link rel="stylesheet" href="bg.css">
    <link rel="stylesheet" href="loader.css">
</head>

<body>
    <div id="preloader">
        <div class="pl">
            <div class="pl__dot"></div>
            <div class="pl__dot"></div>
            <div class="pl__dot"></div>
            <div class="pl__dot"></div>
            <div class="pl__dot"></div>
            <div class="pl__dot"></div>
            <div class="pl__dot"></div>
            <div class="pl__dot"></div>
            <div class="pl__dot"></div>
            <div class="pl__dot"></div>
            <div class="pl__dot"></div>
            <div class="pl__dot"></div>
            <div class="pl__text">Loading…</div>
        </div>
    </div>
    <div id="main-content">
        <div class="background">
            <div class="context">
                <!-- <h1>Pure Css Animated Background</h1> -->
            </div>
            <div class="area">
                <ul class="circles">
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                </ul>
            </div>
        </div>
        <div class="layer-blur"></div>

        <header>
            <nav>
                <div class="sidebar">
                    <div class="logo-content">
                        <div class="logo">
                            <img src="logo.png" alt="" class="log">
                            <span>MedSphere</span>
                            <i class='bx bx-menu' id="btn"></i>
                        </div>
                    </div>
                    <ul>
                        <li class="active"><a href="index.html">
                                <i class='bx bx-home-smile'></i>
                                <span class="nav-item">Home</span>
                            </a></li>
                        <li><a href="about.html">
                                <i class='bx bxs-contact'></i>
                                <span class="nav-item">About</span>
                            </a></li>
                        <li><a href="#key-feature">
                                <i class='bx bx-analyse'></i>
                                <span class="nav-item">Medicine Analyzer</span>
                            </a></li>
                        <li><a href="">
                                <i class='bx bxs-color'></i>
                                <span class="nav-item">Learn More</span>
                            </a></li>
                    </ul>
                </div>
            </nav>
            <div class="home-content">

                <div class="header">
                    <div class="tag-box">
                        <div class="tag">Introducing &wedbar;</div>
                    </div>
                    <h1 id="first_tag">From Generic to Brand <br>— Your Drug Insights Start Here.</h1>
                    <!-- <h1 id="second_tag">Drugs and Medications</h1> -->
                    <p style="max-width: 56%;">Unlock clarity in your prescriptions — from generic to brand, we connect
                        the dots for you.</p>
                    <div class="buttons">
                        <button>
                            <a href="#key-header">Get Started &gt;</a>
                        </button>
                    </div>
                </div>

                <div id="image-container">
                    <img src="test-tube.png" alt="" id="first-img">
                    <img src="Bottle.png" alt="" id="second-img">
                </div>
            </div>

        </header>
        <div class="key-header" id="key-header">
            <h2>Key Features</h2>
            <h2>Key Features</h2>
        </div>
        <section class="key-features" id="key-feature">
            <div class="container">
                <div class="card">
                    <div class="card-content">
                        <a href="maintinence.html">
                            <h2>Drug Details</h2>
                        </a>
                    </div>
                </div>
                <div class="icon" id="first">
                </div>
            </div>
            <div class="container">
                <div class="card">
                    <div class="card-content">
                        <a href="maintinence.html">
                            <h2>Alternative</h2>
                        </a>
                    </div>
                </div>
                <div class="icon" id="second"></div>
            </div>
            <div class="container">
                <div class="card">
                    <div class="card-content">
                        <a href="maintinence.html"><h2>Comparison</h2></a>
                    </div>
                </div>
                <div class="icon" id="third"></div>
            </div>
        </section>
    </div>
</body>
<script>
    let btn = document.querySelector("#btn")
    let sidebar = document.querySelector(".sidebar")
    let navItems = document.querySelectorAll(".nav-item")
    btn.onclick = function () {
        sidebar.classList.toggle("active")
        navItems.forEach(item => {
            item.classList.toggle("active");
        });
    }
    window.addEventListener('load', () => {
        const preloader = document.getElementById('preloader');
        const content = document.getElementById('main-content');

        preloader.classList.add('hidden');
        setTimeout(() => {
            preloader.style.display = 'none';
            content.style.display = 'block';
        }, 500); // match transition duration
    });
    document.getElementById("btn-search").addEventListener("click", () => {
        const medName = document.getElementById("med-input").value;
        const resultsDiv = document.getElementById("results");

        if (!medName) {
            resultsDiv.innerHTML = "<p>Please enter a medicine name.</p>";
            return;
        }
        fetch(`http://127.0.0.1:8000/api/get_alternative?name=${encodeURIComponent(medName)}`)
            .then(response => {
                // Check if the response status is OK (200-299)
                if (!response.ok) {
                    // Handle HTTP errors (e.g., 400, 404, 500)
                    // The backend already sends a JSON error object, so we can parse it
                    return response.json().then(data => {
                        // Propagate the error with the message from the backend
                        throw new Error(data.error || `HTTP error! status: ${response.status}`);
                    });
                }
                // If response is OK, parse the JSON
                return response.json();
            })
            .then(data => {
                // Check for a custom error field in the JSON response
                if (data.error) {
                    resultsDiv.innerHTML = `<p class="text-red-600">Error: ${data.error}</p>`;
                } else {
                    // Extract the data based on the new backend structure
                    const targetDrug = data.target_drug; // Information about the drug searched
                    const similarMeds = data.similar_medicines; // List of similar drugs (summary)
                    const bestAlternative = data.best_alternative_recommendation; // LLM recommendation text

                    let htmlContent = '';

                    // Display information about the target drug
                    if (targetDrug) {
                        htmlContent += `
                    <div class="mb-6 p-4 border border-blue-300 rounded-md bg-blue-50">
                        <h3 class="text-lg font-semibold mb-2">Searched Medicine:</h3>
                        <p><strong>Name:</strong> ${targetDrug.name || 'N/A'}</p>
                        <p><strong>Generic Name:</strong> ${targetDrug.generic_name || 'N/A'}</p>
                        <p><strong>Indication:</strong> ${targetDrug.indication || 'Not Available'}</p>
                        ${targetDrug.description ? `<p><strong>Description:</strong> ${targetDrug.description}</p>` : ''}
                    </div>
                 `;
                    }


                    // Display the list of similar medicines
                    if (similarMeds && similarMeds.length > 0) {
                        htmlContent += `
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-2">Similar Medicines Found:</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                `;
                        htmlContent += similarMeds.map(med => `
                    <div class="p-4 border border-gray-300 rounded-md bg-white shadow-sm">
                        <p><strong>Name:</strong> ${med.name || 'N/A'}</p>
                        <p><strong>Generic Name:</strong> ${med.generic_name || 'N/A'}</p>
                        <p><strong>Indication:</strong> ${med.indication || 'Not Available'}</p>
                        ${med.mechanism ? `<p><strong>Mechanism:</strong> ${med.mechanism || 'Not Available'}</p>` : ''}
                    </div>
                `).join('');
                        htmlContent += `
                        </div>
                    </div>
                 `;
                    } else {
                        htmlContent += `
                    <div class="mb-6 p-4 border border-orange-300 rounded-md bg-orange-50">
                        <p>No other similar medicines found in the index.</p>
                    </div>
                 `;
                    }

                    // Display the best alternative recommendation from the LLM
                    if (bestAlternative) {
                        htmlContent += `
                    <div class="p-4 border border-green-300 rounded-md bg-green-50">
                        <h3 class="text-lg font-semibold mb-2">Best Alternative Recommendation:</h3>
                        <p>${bestAlternative}</p>
                    </div>
                 `;
                    } else {
                        // Handle case where LLM might not return a recommendation
                        htmlContent += `
                    <div class="p-4 border border-orange-300 rounded-md bg-orange-50">
                        <p>Could not generate a specific best alternative recommendation.</p>
                    </div>
                 `;
                    }


                    // Set the innerHTML of the results div
                    resultsDiv.innerHTML = htmlContent;

                    // Add some basic Tailwind CSS classes for styling (assuming Tailwind is used)
                    resultsDiv.classList.add('p-4', 'bg-gray-100', 'rounded-md', 'shadow-lg', 'mt-4');


                }
            })
            .catch(err => {
                // Handle network errors or errors thrown from the .then blocks
                console.error('Fetch error:', err); // Log the error for debugging
                resultsDiv.innerHTML = `<p class="text-red-600">An error occurred: ${err.message || err}</p>`;
                // Remove potential previous styling classes on error
                resultsDiv.classList.remove('p-4', 'bg-gray-100', 'rounded-md', 'shadow-lg', 'mt-4');
            });

    });


</script>

</html>